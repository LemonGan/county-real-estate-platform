# CI/CDç®¡é“é…ç½®æŒ‡å—

## 1. GitHub Actionsé…ç½®

### 1.1 åŸºç¡€CIæµæ°´çº¿

åˆ›å»º `.github/workflows/ci.yml`ï¼š

```yaml
name: Continuous Integration\n\non:\n  push:\n    branches: [ main, dev ]\n  pull_request:\n    branches: [ main, dev ]\n\nenv:\n  PYTHON_VERSION: '3.9'\n  NODE_VERSION: '16'\n\njobs:\n  # åç«¯æµ‹è¯•å’Œæ£€æŸ¥\n  backend-ci:\n    name: Backend CI\n    runs-on: ubuntu-latest\n    \n    services:\n      postgres:\n        image: postgres:14\n        env:\n          POSTGRES_USER: test_user\n          POSTGRES_PASSWORD: test_password\n          POSTGRES_DB: test_db\n        options: >-\n          --health-cmd pg_isready\n          --health-interval 10s\n          --health-timeout 5s\n          --health-retries 5\n        ports:\n          - 5432:5432\n      \n      redis:\n        image: redis:7-alpine\n        options: >-\n          --health-cmd \"redis-cli ping\"\n          --health-interval 10s\n          --health-timeout 5s\n          --health-retries 5\n        ports: \n          - 6379:6379\n    \n    strategy:\n      matrix:\n        python-version: ['3.9', '3.10', '3.11']\n    \n    steps:\n    - name: Checkout code\n      uses: actions/checkout@v4\n      \n    - name: Set up Python ${{ matrix.python-version }}\n      uses: actions/setup-python@v4\n      with:\n        python-version: ${{ matrix.python-version }}\n        cache: 'pip'\n    \n    - name: Install Poetry\n      uses: snok/install-poetry@v1\n      with:\n        version: latest\n        virtualenvs-create: true\n        virtualenvs-in-project: true\n    \n    - name: Load cached venv\n      id: cached-poetry-dependencies\n      uses: actions/cache@v3\n      with:\n        path: .venv\n        key: venv-${{ runner.os }}-${{ matrix.python-version }}-${{ hashFiles('**/poetry.lock') }}\n    \n    - name: Install dependencies\n      if: steps.cached-poetry-dependencies.outputs.cache-hit != 'true'\n      run: |\n        cd backend\n        poetry install --no-interaction --no-ansi\n      working-directory: ./backend\n    \n    - name: Run linting\n      run: |\n        cd backend\n        poetry run flake8 app/ --count --select=E9,F63,F7,F82 --show-source --statistics\n        poetry run flake8 app/ --count --exit-zero --max-complexity=10 --max-line-length=88 --statistics\n        poetry run black --check app/\n        poetry run isort --check-only app/\n      working-directory: ./backend\n    \n    - name: Run type checking\n      run: |\n        cd backend\n        poetry run mypy app/\n      working-directory: ./backend\n    \n    - name: Run tests with coverage\n      run: |\n        cd backend\n        poetry run pytest tests/ -v --cov=app --cov-report=xml\n      working-directory: ./backend\n      env:\n        DATABASE_URL: postgresql://test_user:test_password@localhost:5432/test_db\n        REDIS_URL: redis://localhost:6379/0\n        SECRET_KEY: test-secret-key\n    \n    - name: Upload coverage to Codecov\n      uses: codecov/codecov-action@v3\n      with:\n        file: backend/coverage.xml\n        flags: backend\n        name: backend-coverage-${{ matrix.python-version }}\n    \n  # å‰ç«¯å°ç¨‹åºæ£€æŸ¥  \n  frontend-check:\n    name: Frontend Code Check\n    runs-on: ubuntu-latest\n    \n    steps:\n    - name: Checkout code\n      uses: actions/checkout@v4\n      \n    - name: Set up Node.js\n      uses: actions/setup-node@v3\n      with:\n        node-version: ${{ env.NODE_VERSION }}\n        cache: 'npm'\n        cache-dependency-path: miniprogram/package-lock.json\n    \n    - name: Check MiniProgram structure\n      run: |\n        # æ£€æŸ¥å°ç¨‹åºåŸºæœ¬ç»“æ„\n        if [ ! -f \"miniprogram/app.json\" ]; then\n          echo \"âŒ app.json not found\"\n          exit 1\n        fi\n        if [ ! -f \"miniprogram/app.js\" ]; then\n          echo \"âŒ app.js not found\"\n          exit 1\n        fi\n        if [ ! -d \"miniprogram/pages\" ]; then\n          echo \"âŒ pages directory not found\"\n          exit 1\n        fi\n        \n        echo \"âœ… MiniProgram structure check passed\"\n        \n        # æ£€æŸ¥é…ç½®æ–‡ä»¶æ ¼å¼\n        python -c \"import json; json.load(open('miniprogram/app.json'))\" || {\n          echo \"âŒ app.json format invalid\"\n          exit 1\n        }\n\n  # å®‰å…¨æ‰«æ\n  security-scan:\n    name: Security Scan\n    runs-on: ubuntu-latest\n    permissions:\n      security-events: write\n    \n    steps:\n    - name: Checkout code\n      uses: actions/checkout@v4\n      \n    - name: Run Trivy vulnerability scanner\n      uses: aquasecurity/trivy-action@master\n      with:\n        scan-type: 'fs'\n        scan-ref: '.'\n        format: 'sarif'\n        output: 'trivy-results.sarif'\n        \n    - name: Upload Trivy scan results to GitHub Security tab\n      uses: github/codeql-action/upload-sarif@v2\n      with:\n        sarif_file: 'trivy-results.sarif'\n\n  build-test:\n    name: Build Test\n    runs-on: ubuntu-latest\n    needs: [backend-ci, frontend-check]\n    \n    steps:\n    - name: Checkout code  \n      uses: actions/checkout@v4\n      \n    - name: Test Docker build\n      run: |\n        cd backend\n        docker build -t test-build .\n        echo \"âœ… Docker build successful\"\n```

### 1.2 CDéƒ¨ç½²æµæ°´çº¿

åˆ›å»º `.github/workflows/cd.yml`ï¼š

```yaml
name: Continuous Deployment\n\non:\n  push:\n    tags:\n      - 'v*'  # ç‰ˆæœ¬æ ‡ç­¾è§¦å‘éƒ¨ç½²\n    branches:\n      - main\n\nenv:\n  REGISTRY: ghcr.io  # GitHub Container Registry\n  IMAGE_NAME: ${{ github.repository }}\n\njobs:\n  build-and-push:\n    name: Build and Push Images\n    runs-on: ubuntu-latest\n    permissions:\n      contents: read\n      packages: write\n    \n    steps:\n    - name: Checkout repository\n      uses: actions/checkout@v4\n      \n    - name: Set up Docker Buildx\n      uses: docker/setup-buildx-action@v3\n      \n    - name: Log in to the Container registry\n      uses: docker/login-action@v3\n      with:\n        registry: ${{ env.REGISTRY }}\n        username: ${{ github.actor }}\n        password: ${{ secrets.GITHUB_TOKEN }}\n    \n    - name: Extract metadata (tags, labels) for Docker\n      id: meta\n      uses: docker/metadata-action@v5\n      with:\n        images: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}\n        tags: |\n          type=ref,event=branch\n          type=ref,event=pr\n          type=semver,pattern={{version}}\n          type=semver,pattern={{major}}.{{minor}}\n        labels: |\n          maintainer=${{ github.actor }}\n          org.opencontainers.image.title=County Real Estate Platform\n          org.opencontainers.image.description=å¿åŸŸæˆ¿äº§ä¿¡æ¯å¹³å°\n          org.opencontainers.image.version=${{ github.ref_name }}\n          org.opencontainers.image.revision=${{ github.sha }}\n          org.opencontainers.image.source=${{ github.server_url }}/${{ github.repository }}\n    \n    - name: Build and push backend image\n      uses: docker/build-push-action@v5\n      with:\n        context: ./backend\n        file: ./backend/docker/Dockerfile\n        push: true\n        tags: ${{ steps.meta.outputs.tags }}\n        labels: ${{ steps.meta.outputs.labels }}\n        cache-from: type=gha\n        cache-to: type=gha,mode=max\n        platforms: linux/amd64,linux/arm64\n    \n  deploy-development:\n    name: Deploy to Development\n    runs-on: ubuntu-latest\n    needs: build-and-push\n    if: github.ref == 'refs/heads/main'\n    environment: development\n    \n    steps:\n    - name: Deploy to development server\n      run: |\n        # è¿™é‡Œå¯ä»¥æ·»åŠ å®é™…çš„éƒ¨ç½²é€»è¾‘\n        # ä¾‹å¦‚é€šè¿‡SSHè¿æ¥åˆ°æœåŠ¡å™¨è¿›è¡Œéƒ¨ç½²\n        echo \"ğŸ—ï¸ Deploying to development environment\"\n        echo \"Backend image: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:sha-${GITHUB_SHA::8}\"\n        \n        # ç¤ºä¾‹ï¼šç‰ˆæœ¬æ ‡è®°\n        docker pull ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:sha-${GITHUB_SHA::8}\n        echo \"âœ… Development deployment successful!\"\n    \n  deploy-staging:\n    name: Deploy to Staging\n    runs-on: ubuntu-latest\n    needs: build-and-push\n    if: startsWith(github.ref, 'refs/tags/v')\n    environment: staging\n    \n    steps:\n    - name: Deploy to staging server\n      run: |\n        echo \"ğŸš€ Deploying to staging environment (tag: ${{ github.ref_name }})\"\n        # å®é™…éƒ¨ç½²é€»è¾‘\n        echo \"âœ… Staging deployment successful!\"\n    \n  deploy-production:\n    name: Deploy to Production\n    runs-on: ubuntu-latest\n    needs: build-and-push\n    if: startsWith(github.ref, 'refs/tags/v')\n    environment: production\n    \n    steps:\n    - name: Deploy to production server\n      run: |\n        echo \"ğŸ¯ Deploying to production environment (tag: ${{ github.ref_name }})\"\n        # å®é™…éƒ¨ç½²é€»è¾‘\n        echo \"â¸ï¸ Production deployment requires manual approval in GitHub\"\n```\n\n## 2. è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬\n\n### 2.1 Dockerå®¹å™¨åŒ–é…ç½®

#### åç«¯Dockerfile
```dockerfile\n# Multi-stage build\nFROM python:3.9-slim as builder\n\nENV PYTHONDONTWRITEBYTECODE=1\\\n    PYTHONUNBUFFERED=1\\\n    PIP_NO_CACHE_DIR=1\\\n    PIP_DISABLE_PIP_VERSION_CHECK=1\\\n    POETRY_NO_INTERACTION=1\\\n    POETRY_REUSE_PROJECT_VENV=1\\\n    POETRY_VIRTUALENV_IN_PROJECT=1\n\n# Install system dependencies\nRUN apt-get update && apt-get install -y \\\n    build-essential \\\n    libpq-dev \\\n    curl \\\n    && rm -rf /var/lib/apt/lists/*\n\n# Install Poetry\nRUN pip install poetry\n\nWORKDIR /app\n\n# Copy dependency files\nCOPY pyproject.toml poetry.lock ./\nRUN poetry install --no-dev\n\n# Production stage\nFROM python:3.9-slim as production\n\nENV PYTHONDONTWRITEBYTECODE=1\\\n    PYTHONUNBUFFERED=1\\\n    PATH=/app/.venv/bin:$PATH\n\n# Install runtime dependencies\nRUN apt-get update && apt-get install -y \\\n    libpq5 \\\n    netcat-openbsd \\\n    curl \\\n    && rm -rf /var/lib/apt/lists/*\n\n# Create non-root user\nRUN useradd -r -s /bin/false -u 1000 appuser \\\n    && mkdir -p /app/logs \\\n    && chown -R appuser:appuser /app\n\nWORKDIR /app\n\n# Copy virtual environment from builder stage\nCOPY --from=builder /app/.venv /app/.venv\n\n# Copy application code\nCOPY --chown=appuser:appuser . .\n\n# Health check\nHEALTHCHECK --interval=30s --timeout=10s --start-period=40s --retries=3 \\\n    CMD curl -f http://localhost:8000/health || exit 1\n\n# Switch to non-root user\nUSER appuser\n\n# Expose port\nEXPOSE 8000\n\n# Default command\nCMD [\"uvicorn\", \"app.main:app\", \"--host\", \"0.0.0.0\", \"--port\", \"8000\", \"--workers\", \"2\", \"--proxy-headers\", \"--forwarded-allow-ips=\"]\n```\n\n### 2.2 Docker Composeé…ç½®
```yaml\nversion: '3.8'\n\nservices:\n  app:\n    build:\n      context: ./backend\n      dockerfile: docker/Dockerfile\n    container_name: xqfc-app\n    restart: unless-stopped\n    environment:\n      - DATABASE_URL=postgresql://xqfc_user:${DB_PASSWORD}@postgres:5432/xqfc_production\n      - REDIS_URL=redis://redis:6379/0\n      - SECRET_KEY=${SECRET_KEY}\n      - ENVIRONMENT=production\n      - MAX_WORKERS=4\n    depends_on:\n      postgres:\n        condition: service_healthy\n      redis:\n        condition: service_healthy\n    ports:\n      - \"8000:8000\"\n    volumes:\n      - ./logs:/app/logs\n      - ./static:/app/static\n      - ./uploads:/app/uploads\n    networks:\n      - app-network\n    healthcheck:\n      test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:8000/health\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n      start_period: 40s\n\n  postgres:\n    image: postgres:14-alpine\n    container_name: xqfc-postgres\n    restart: unless-stopped\n    environment:\n      - POSTGRES_USER=xqfc_user\n      - POSTGRES_PASSWORD=${DB_PASSWORD}\n      - POSTGRES_DB=xqfc_production\n    volumes:\n      - postgres_data:/var/lib/postgresql/data\n      - ./backup:/backup\n      - ./postgres/init.sql:/docker-entrypoint-initdb.d/init.sql\n    ports:\n      - \"5432:5432\"\n    networks:\n      - app-network\n    healthcheck:\n      test: [\"CMD-SHELL\", \"pg_isready -U xqfc_user -d xqfc_production\"]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n\n  redis:\n    image: redis:7-alpine\n    container_name: xqfc-redis\n    restart: unless-stopped\n    ports:\n      - \"6379:6379\"\n    volumes:\n      - redis_data:/data\n      - ./redis.conf:/usr/local/etc/redis/redis.conf\n    networks:\n      - app-network\n    command: redis-server /usr/local/etc/redis/redis.conf\n    healthcheck:\n      test: [\"CMD\", \"redis-cli\", \"ping\"]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n\n  nginx:\n    image: nginx:alpine\n    container_name: xqfc-nginx\n    restart: unless-stopped\n    ports:\n      - \"80:80\"\n      - \"443:443\"\n    volumes:\n      - ./nginx/nginx.conf:/etc/nginx/nginx.conf\n      - ./nginx/ssl:/etc/nginx/ssl\n      - ./static:/usr/share/nginx/html/static\n      - ./logs/nginx:/var/log/nginx\n    depends_on:\n      - app\n    networks:\n      - app-network\n    healthcheck:\n      test: [\"CMD\", \"nginx\", \"-t\"]\n      interval: 30s\n      timeout: 5s\n      retries: 3\n\n  # å¯é€‰ï¼šç›‘æ§å®¹å™¨\n  prometheus:\n    image: prom/prometheus:latest\n    container_name: xqfc-prometheus\n    restart: unless-stopped\n    ports:\n      - \"9090:9090\"\n    volumes:\n      - ./prometheus/prometheus.yml:/etc/prometheus/prometheus.yml\n      - prometheus_data:/prometheus\n    networks:\n      - app-network\n    command:\n      - '--config.file=/etc/prometheus/prometheus.yml'\n      - '--storage.tsdb.path=/prometheus'\n      - '--web.console.libraries=/etc/prometheus/console_libraries'\n      - '--web.console.templates=/etc/prometheus/consoles'\n      - '--storage.tsdb.retention.time=200h'\n      - '--web.enable-lifecycle'\n    profiles:\n      - monitoring\n\n  grafana:\n    image: grafana/grafana:latest\n    container_name: xqfc-grafana\n    restart: unless-stopped\n    ports:\n      - \"3000:3000\"\n    environment:\n      - GF_SECURITY_ADMIN_USER=admin\n      - GF_SECURITY_ADMIN_PASSWORD=${GRAFANA_PASSWORD}\n    volumes:\n      - grafana_data:/var/lib/grafana\n      - ./grafana/provisioning:/etc/grafana/provisioning\n    depends_on:\n      - prometheus\n    networks:\n      - app-network\n    profiles:\n      - monitoring\n\nvolumes:\n  postgres_data:\n  redis_data:\n  prometheus_data:\n  grafana_data:\n\nnetworks:\n  app-network:\n    driver: bridge\n\n# ç¯å¢ƒé…ç½®æ–‡ä»¶\n# .envæ–‡ä»¶å†…å®¹:\n# DB_PASSWORD=your_secure_password\n# SECRET_KEY=your_very_long_secret_key\n# GRAFANA_PASSWORD=your_grafana_password\n```\n\n### 2.3 éƒ¨ç½²è„šæœ¬é›†åˆ
\n#### è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬\n```bash\n#!/bin/bash\n# scripts/deploy-production.sh\n\nset -e\n\n# é…ç½®å˜é‡\nPROJECT_DIR=\"/opt/xqfc\"\nBACKUP_DIR=\"/opt/xqfc/backup\"\nLOG_DIR=\"/opt/xqfc/logs\"\nDEPLOY_LOG=\"$LOG_DIR/deploy-$(date +%Y%m%d_%H%M%S).log\"\nENV_FILE=\"$PROJECT_DIR/.env\"\n\n# é¢œè‰²è¾“å‡º\nRED='\\033[0;31m'\nGREEN='\\033[0;32m'\nYELLOW='\\033[1;33m'\nNC='\\033[0m' # No Color\n\nlog() {\n    echo -e \"${GREEN}[$(date '+%Y-%m-%d %H:%M:%S')] $1${NC}\" | tee -a \"$DEPLOY_LOG\"\n}\n\nwarn() {\n    echo -e \"${YELLOW}[$(date '+%Y-%m-%d %H:%M:%S')] WARNING: $1${NC}\" | tee -a \"$DEPLOY_LOG\"\n}\n\nerror() {\n    echo -e \"${RED}[$(date '+%Y-%m-%d %H:%M:%S')] ERROR: $1${NC}\" | tee -a \"$DEPLOY_LOG\"\n}\n\n# å‡½æ•°å®šä¹‰\nsetup_environment() {\n    log \"Setting up deployment environment...\"\n    \n    # åˆ›å»ºå¿…è¦çš„ç›®å½•\n    mkdir -p \"$BACKUP_DIR\" \"$LOG_DIR\" \"$PROJECT_DIR\"\n    \n    # éªŒè¯ç¯å¢ƒå˜é‡æ–‡ä»¶\n    if [ ! -f \"$ENV_FILE\" ]; then\n        error \"Environment file not found: $ENV_FILE\"\n        exit 1\n    fi\n    \n    log \"Environment setup completed\"\n}\n\nstop_services() {\n    log \"Stopping current services...\"\n    \n    cd \"$PROJECT_DIR\"\n    if [ -f \"docker-compose.yml\" ]; then\n        docker-compose down --timeout=30\n    fi\n    \n    log \"Services stopped successfully\"\n}\n
backup_data() {\n    log \"Backing up data...\"\n    \n    # æ•°æ®åº“å¤‡ä»½\n    if docker ps | grep -q xqfc-postgres; then\n        log \"Backing up database...\"\n        BACKUP_NAME=\"db_backup_$(date +%Y%m%d_%H%M%S).sql\"\n        docker exec xqfc-postgres pg_dump -U xqfc_user xqfc_production \u003e \"$BACKUP_DIR/$BACKUP_NAME\"\n        gzip \"$BACKUP_DIR/$BACKUP_NAME\"\n        log \"Database backup completed: $BACKUP_NAME.gz\"\n    fi\n    \n    # é…ç½®å¤‡ä»½\n    if [ -d \"$PROJECT_DIR/nginx\" ]; then\n        tar -czf \"$BACKUP_DIR/nginx_backup_$(date +%Y%m%d_%H%M%S).tar.gz\" -C \"$PROJECT_DIR\" nginx/\n    fi\n    \n    log \"Backup completed\"\n}\n\nupdate_code() {\n    log \"Updating application code...\"\n    \n    cd \"$PROJECT_DIR\"\n    \n    # æ‹‰å–æœ€æ–°ä»£ç \n    if [ -d \".git\" ]; then\n        git pull origin main\n    else\n        warn \"No git repository found, skipping code update\"\n    fi\n    \n    log \"Code updated successfully\"\n}\n\nrun_migrations() {\n    log \"Running database migrations...\"\n    \n    cd \"$PROJECT_DIR\"\n    \n    # å¯åŠ¨æ•°æ®åº“ä¸´æ—¶å®¹å™¨è¿›è¡Œè¿ç§»\n    docker-compose up -d postgres\n    \n    # ç­‰å¾…æ•°æ®åº“å°±ç»ª\n    timeout=60\n    while ! docker exec xqfc-postgres pg_isready -U xqfc_user; do\n        sleep 2\n        timeout=$((timeout - 2))\n        if [ $timeout -le 0 ]; then\n            error \"Database startup timeout\n            exit 1\n        fi\n    done\n    \n    # è¿è¡Œæ•°æ®åº“è¿ç§»\n    docker-compose run --rm app poetry run alembic upgrade head\n    \n    log \"Database migrations completed\"\n}\n\ndeploy_containers() {\n    log \"Deploying containerized services...\"\n    \n    cd \"$PROJECT_DIR\"\n    \n    # æ‹‰å–æœ€æ–°é•œåƒ\n    docker-compose pull\n    \n    # æ„å»ºåº”ç”¨é•œåƒ\n    docker-compose build app\n    \n    # å¯åŠ¨æœåŠ¡\n    docker-compose up -d\n    \n    # ç­‰å¾…æœåŠ¡å°±ç»ª\n    log \"Waiting for services to be healthy...\"\n    sleep 30\n    \n    # å¥åº·æ£€æŸ¥\n    if curl -f http://localhost:8000/health > /dev/null 2>>&1; then\n        log \"âœ… Application is healthy!\"\n    else\n        error \"âŒ Health check failed\"\n        return 1\n    fi\n    \n    log \"Container deployment completed\"\n}\n\ncleanup() {\n    log \"Performing cleanup...\"\n    \n    # æ¸…ç†æ—§é•œåƒ\n    docker image prune -f > /dev/null 2>>1\n    \n    # æ¸…ç†æ—§æ—¥å¿— (ä¿ç•™æœ€è¿‘7å¤©çš„æ—¥å¿—)\n    find \"$LOG_DIR\" -name \"deploy-*.log\" -mtime +7 -delete 2> /dev/null <> /dev/null || true\n    \n    # æ¸…ç†æ—§å¤‡ä»½ (ä¿ç•™æœ€è¿‘30å¤©çš„å¤‡ä»½)\n    find \"$BACKUP_DIR\" -name \"*.gz\" -mtime +30 -delete 2> /dev/null <> /dev/null || true\n    \n    log \"Cleanup completed\"\n}\n\nnotify_success() {\n    log \"ğŸ‰ Deployment completed successfully!\"\n    log \"Application is now running at: http://$(curl -s ifconfig.me)\"\n}\n\nnotify_failure() {\n    error \"âŒ Deployment failed!\"\n    error \"Check logs at: $DEPLOY_LOG\"\n    \n    # å‘é€å¤±è´¥é€šçŸ¥ (å¦‚æœé…ç½®äº†é€šçŸ¥æœåŠ¡)\n    if command -v curl > /dev/null 2>>1; then\n        # ç¤ºä¾‹ï¼šå‘é€Webhooké€šçŸ¥\n        # curl -X POST \\  \n          -H \"Content-Type: application/json\" \\\n          -d '{\"text\":\"ğŸš¨ éƒ¨ç½²å¤±è´¥ï¼šå¿åŸŸæˆ¿äº§å¹³å°\"}' \\\n          \"$WEBHOOK_URL\" 2> /dev/null || true\n    fi\n}\n\n# é”™è¯¯å¤„ç†\ntrap 'notify_failure; exit 1' ERR \n\n# ä¸»æ‰§è¡Œæµç¨‹\nmain() {\n    log \"ğŸš€ Starting deployment process...\"\n    \n    setup_environment\n    backup_data\n    stop_services\n    update_code\n    run_migrations\n    deploy_containers\n    cleanup\n    notify_success\n    \n    log \"âœ¨ Deployment process completed successfully!\"\n    \n    # è¾“å‡ºéƒ¨ç½²æ‘˜è¦\n    echo \"\\nğŸ“‹ DEPLOYMENT SUMMARY:\"\n    echo \"  - Application: http://$(curl -s ifconfig.me)\"\n    echo \"  - API Docs: http://$(curl -s ifconfig.me)/docs\"\n    echo \"  - Monitoring: http://$(curl -s ifconfig.me):3000\" \n    echo \"  - Logs: $DEPLOY_LOG\"\n    echo \"  - Backup: $BACKUP_DIR\"\n}\n\n# æ˜¾ç¤ºå¸®åŠ©\nif [ \"$1\" = \"--help\" ] <> [ \"$1\" = \"-h\" ]; then\n    cat << EOF\nUsage: $0 [OPTIONS]\n\nOptions:\n  --help, -h     Display this help message\n  --rollback     Rollback to previous stable version\n  --dry-run      Show what would be done without executing\n\nEnvironment Variables:\n  ENV_FILE - Path to environment file (default: $PROJECT_DIR/.env)\n  WEBHOOK_URL - URL for deployment notifications\n  \nExamples:\n  $0                           # Normal deployment\n  $0 --dry-run                # Simulate deployment\n  $0 --rollback               # Rollback deployment\nEOF\n    exit 0\nfi\n\n# å‚æ•°å¤„ç†\ncase \"$1\" in\n    --rollback)\n        # TODO: å®ç°å›æ»šé€»è¾‘\n        warn \"Rollback functionality to be implemented\"\n        exit 0\n        ;;\n    --dry-run)\n        warn \"Dry run mode - deployment simulation\"\n        # TODO: å®ç°æ¨¡æ‹Ÿéƒ¨ç½²é€»è¾‘\n        exit 0\n        ;;\nesac\n\n# æ‰§è¡Œä¸»æµç¨‹\nmain "$@"\"\","file_path":"D:\pycharm\house-sms\cicd-deploy-scripts.md